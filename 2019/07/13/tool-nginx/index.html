<!DOCTYPE html><html lang="zh-TW"><head><meta charset="utf-8"><meta name="theme-color" content="#0077B5"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="tfWfY4bkeILtxNyUg9UGfVkCNvKtAauF2r9WDQs8kBM"><meta property="fb:pages" content="219138595338413"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="å—¨ï¼Œæˆ‘æ˜¯æ—å½¥æˆï¼Œæ˜¯å€‹å–œæ­¡çˆ¬å±±çš„å‰ç«¯å·¥ç¨‹å¸«ï¼Œå°ˆæ³¨åœ¨ React.js çš„ç›¸é—œé–‹ç™¼ï¼Œé€™å€‹éƒ¨è½æ ¼æœƒåˆ†äº«ç¶²ç«™æŠ€è¡“ã€è·æ¶¯ç™¼å±•ã€å€‹äººæˆé•·å’Œç”¢æ¥­è§€å¯Ÿç›¸é—œæ–‡ç« ã€‚"><meta name="keyword" content="å‰ç«¯ä¸‰åˆ†é˜, å‰ç«¯, React.js, æ—å½¥æˆ, ç¶²ç«™æŠ€è¡“, è·æ¶¯ç™¼å±•, å€‹äººæˆé•·, ç”¢æ¥­è§€å¯Ÿ"><meta property="og:image" content="/img/icon_wechat.png"><link rel="shortcut icon" href="/img/favicon.ico"><title>Nginx Config èˆ‡å¸¸ç”¨æŒ‡ä»¤æ•™å­¸: å¿«é€Ÿå…¥é–€ç¶²ç«™æ¶è¨­ | å‰ç«¯ä¸‰åˆ†é˜ | ä¸€èµ·ç”¨ä¸‰åˆ†é˜åˆ†äº«æŠ€è¡“èˆ‡çŸ¥è­˜</title><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"><link rel="canonical" href="https://linyencheng.github.io/2019/07/13/tool-nginx/"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/blog.min.css"><link rel="stylesheet" href="/css/highlight.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/feed.xml" title="å‰ç«¯ä¸‰åˆ†é˜" type="application/atom+xml"></head><body ontouchstart=""><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">å‰ç«¯ä¸‰åˆ†é˜</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a title="é¦–é " href="/">é¦–é </a></li><li><a href="/categories/">åˆ†é¡</a></li><li><a href="/about/">é—œæ–¼</a></li><li><a href="/archives/">åˆ—è¡¨</a></li><li><a href="/tags/">æ¨™ç±¤</a></li><li><a title="éš±ç§æ¬Šæ”¿ç­–" href="/pravicy">éš±ç§æ¬Šæ”¿ç­–</a></li></ul></div></div></div></nav><script async>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){0<$navbar.className.indexOf("in")?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><style>.intro-header{position:relative;overflow:hidden;background:repeating-linear-gradient(0deg,rgba(255,255,255,.3) 0,rgba(255,255,255,.3) 1px,transparent 1px,transparent 10px),repeating-linear-gradient(90deg,rgba(255,255,255,.3) 0,rgba(255,255,255,.3) 1px,transparent 1px,transparent 10px);background-color:#b4dbf8}@media (max-width:768px){.mobile-hidden{display:none}}</style><progress value="0" id="progressBar" class="flat"><div class="progress-container"><span class="progress-bar"></span></div></progress><header class="intro-header"><div class="geometric-pattern"><div class="shape"></div><div class="shape"></div><div class="shape"></div><div class="shape mobile-hidden"></div><div class="shape mobile-hidden"></div><div class="shape mobile-hidden"></div></div><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><div class="tags"><a class="tag" href="/tags/#é›²ç«¯æœå‹™" title="é›²ç«¯æœå‹™">é›²ç«¯æœå‹™</a></div><h1 class="mb-0"><span>Nginx Config èˆ‡å¸¸ç”¨æŒ‡ä»¤æ•™å­¸</span> <span class="subheading mb-2">å¿«é€Ÿå…¥é–€ç¶²ç«™æ¶è¨­</span></h1><a class="post-user-meta post-user-meta--big" href="/about"><img loading="lazy" alt="me" class="userPhoto d-inline-block" src="/img/me_icon.jpg"><div class="d-inline-block"><span class="user-name" style="color:#fff">æ—å½¥æˆ</span><br><span style="color:#fff">2019-07-13 | 5 min.</span> <span id="viewCountTotal" style="color:#fff"></span></div></a></div></div></div></div></header><article id="article-post"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container"><div id="toc" class="toc-article"><strong class="toc-title h3">æ–‡ç« ç›®éŒ„</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">1.</span> <span class="toc-text">Nginx å¸¸ç”¨æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-Nginx"><span class="toc-number">1.1.</span> <span class="toc-text">å®‰è£ Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">Nginx ç®¡ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-Log"><span class="toc-number">1.3.</span> <span class="toc-text">Nginx Log</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-config-%E5%9F%BA%E7%A4%8E%E8%A8%AD%E5%AE%9A"><span class="toc-number">2.</span> <span class="toc-text">Nginx config åŸºç¤è¨­å®š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A6%8B%E7%9A%84-Nginx-Config"><span class="toc-number">3.</span> <span class="toc-text">å¸¸è¦‹çš„ Nginx Config</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-proxy-pass-%E8%A8%AD%E5%AE%9A"><span class="toc-number">3.1.</span> <span class="toc-text">Nginx proxy_pass è¨­å®š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-Nginx-Reverse-Proxy"><span class="toc-number">3.2.</span> <span class="toc-text">åå‘ä»£ç† (Nginx Reverse Proxy)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-https-%E8%A8%AD%E5%AE%9A"><span class="toc-number">3.3.</span> <span class="toc-text">Nginx https è¨­å®š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96%E8%A8%AD%E5%AE%9A"><span class="toc-number">4.</span> <span class="toc-text">Nginx æ•ˆèƒ½å„ªåŒ–è¨­å®š</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-Epoll"><span class="toc-number">4.1.</span> <span class="toc-text">Nginx Epoll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-%E7%B3%BB%E7%B5%B1%E6%A0%B8%E5%BF%83%E8%A8%AD%E5%AE%9A"><span class="toc-number">4.2.</span> <span class="toc-text">Linux ç³»çµ±æ ¸å¿ƒè¨­å®š</span></a></li></ol></li></ol></div><br><div class="google-ad"><ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-h4+1+1q-1t-2x" data-ad-client="ca-pub-1297466993744883" data-ad-slot="9012117796"></ins></div><p>Nginx æ˜¯éåŒæ­¥æ¡†æ¶çš„ç¶²é ä¼ºæœå™¨ï¼Œä¸»è¦ç”¨æ–¼</p><ul><li>åå‘ä»£ç† (reverse proxy) èƒ½ä½œç‚º API Gateway é€²è¡Œå¾Œç«¯åˆ†æµ</li><li>è² è¼‰å¹³è¡¡ (load balancer) å’Œå¿«å– (HTTP Cache) å¯ç”¨æ–¼éœæ…‹ç¶²ç«™æ¶è¨­</li></ul><p>è®“æˆ‘å€‘ä¾†é–‹ç®±æ•™å­¸ Nginx å¸¸ç”¨æŒ‡ä»¤å’Œ Nginx Config (Reverse Proxyã€https) èˆ‡æ•ˆèƒ½å„ªåŒ–ï¼Œå¦ä¸€ç¯‡æ–‡ç« æœƒæ¥è‘—ä»‹ç´¹ <a href="/2022/12/25/tool-nginx-management/?utm_source=link&utm_medium=article&utm_campaign=internal_link">Nginx ç®¡ç†èˆ‡ç›£æ§å·¥å…· Nginx Proxy Managerã€Nginx GIXYã€GoAccess</a>ã€‚</p><h2 id="Nginx-å¸¸ç”¨æŒ‡ä»¤"><a href="#Nginx-å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="Nginx å¸¸ç”¨æŒ‡ä»¤"></a>Nginx å¸¸ç”¨æŒ‡ä»¤</h2><p>Linux æ˜¯æª”æ¡ˆç³»çµ±ï¼Œæ‰€ä»¥æª”æ¡ˆè¦æœ‰ç³»çµ±çš„è¢«æ”¾ç½®</p><ol><li>åœ¨ home ç›®éŒ„åº•ä¸‹çš„{ä½¿ç”¨è€…åç¨±}ç›®éŒ„: å›  linux æ¬Šé™è¦åŠƒåš´è¬¹ï¼Œæª”æ¡ˆéƒ½æœ‰å­˜å–æ¬Šé™ï¼Œå»ºè­°ç™¼ä½ˆä½ç½®æ”¾åœ¨é€™å€‹ç›®éŒ„ä¸‹</li><li>etc (é…ç½®æª”)</li><li>var(log)</li></ol><h3 id="å®‰è£-Nginx"><a href="#å®‰è£-Nginx" class="headerlink" title="å®‰è£ Nginx"></a>å®‰è£ Nginx</h3><ol><li>linux ç’°å¢ƒå®‰è£ Nginx</li></ol><ul><li>putty + ssh é€£æ¥è‡³ä¸»æ©Ÿ</li><li>å‡ç´šç³»çµ±ç›¸é—œå¥—ä»¶èˆ‡æœå‹™</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install nginx</span><br></pre></td></tr></table></figure><ol start="2"><li>windows ç’°å¢ƒï¼Œåœ¨ Windows åªéœ€è¦ä¸‹è¼‰å¾Œè§£å£“ç¸®ï¼Œå³å¯åŸ·è¡Œ <code>start nginx</code> ä½¿ç”¨ã€‚</li></ol><h3 id="Nginx-ç®¡ç†"><a href="#Nginx-ç®¡ç†" class="headerlink" title="Nginx ç®¡ç†"></a>Nginx ç®¡ç†</h3><p>åœ¨ Linux ä¸»æ©Ÿä¸Šé‹ç”¨ Systemctl åš Nginx æœå‹™ç®¡ç†ï¼Œåœ¨ Linux ä¸­æœƒä½¿ç”¨ <code>sudo systemctl</code> åŠ ä¸Šåº•ä¸‹å¹¾ç¨®æŒ‡ä»¤:</p><ol><li>status (ç‹€æ…‹)</li><li>stop (åœæ­¢)</li><li>start (é–‹å§‹)</li><li>enable (é–‹æ©Ÿå•Ÿç”¨)</li><li>restart (é‡é–‹)</li></ol><p>åº•ä¸‹çš„ç¯„ä¾‹å°±æ˜¯çœ‹ nginx ç›®å‰çš„ç‹€æ…‹ï¼Œæ¥è‘—åˆ—å‡ºæœ‰åœ¨é–‹æ©Ÿé è¨­é–‹å•Ÿä¸­çš„ç¨‹å¼æˆ–æœå‹™ï¼Œæœ€å¾Œçœ‹ç›®å‰æœ‰åœ¨åŸ·è¡Œçš„æœå‹™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br><span class="line">systemctl list-unit-files | grep enabled</span><br><span class="line">systemctl | grep running</span><br></pre></td></tr></table></figure><p>Windows æ›¾é‡éèµ·ä¾†å¤šå€‹ processes é—œä¸æ‰ï¼Œæ‰€ä»¥å»ºè­°ä¿®æ”¹é…ç½®å¾Œä½¿ç”¨ <code>nginx -s reload</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop    // fast shutdown</span><br><span class="line">nginx -s quit    // graceful shutdown</span><br><span class="line">nginx -s reload  // starting new worker processes with a new configuration, graceful shutdown of old worker processes</span><br><span class="line">nginx -s reopen  // re-opening <span class="built_in">log</span> files</span><br></pre></td></tr></table></figure><h3 id="Nginx-Log"><a href="#Nginx-Log" class="headerlink" title="Nginx Log"></a>Nginx Log</h3><p>Linux çš„ log æœƒåœ¨ <code>/var/log</code>:</p><ul><li>access log: ä½ç½®æœƒåœ¨ <code>/var/log/nginx/access.log</code></li><li>error log: ä½ç½®æœƒåœ¨ <code>/var/log/nginx/error.log</code></li></ul><p>æŸ¥çœ‹ nginx çš„ access logï¼Œ<code>tail -f /var/log/nginx/access.log</code>ï¼Œé€™é‚Šæ¨è–¦å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://goaccess.io/">GoAccess</a> å°‡è³‡è¨Šåœ–åƒåŒ–ï¼Œä¸¦æ­é… Linux çš„ <a target="_blank" rel="noopener" href="https://github.com/allinurl/goaccess/issues/703">crontab æ’ç¨‹</a>é€²è¡Œè‡ªå‹•æ›´æ–°ã€‚</p><p>å¦‚æœæ²’æœ‰ç®¡ç† log å¯èƒ½æœƒä½”è »å¤šç¡¬ç¢Ÿç©ºé–“ (æŸ¥çœ‹ç¡¬ç¢Ÿä½¿ç”¨æƒ…æ³: <code>sudo du -sh /var/log/</code>)ï¼Œæ”¹å–„æ–¹æ³•æœ‰ä»¥ä¸‹å¹¾ç¨®ï¼š</p><ol><li>è¨­å®š Logrotate: <code>/etc/logrotate.d</code></li><li>æŒ‡ä»¤æ¸…é™¤ <code>sudo find /var/log/ -type f -regex &#39;.*\.[0-9]+\.gz$&#39; -delete</code></li><li>é—œæ‰ Access Logging: åªè¦ç´€éŒ„å°±æœƒå° CPU ç¡¬ç¢Ÿç”¢ç”Ÿæ¶ˆè€—</li><li>å¢åŠ  <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_log_module.html?&_ga=2.255673355.2046281064.1594341677-1932426211.1594341677#access_log">buffer size</a> ä¸è¦é »ç¹çš„è£½é€  CPU è™•ç†ç¡¬ç¢Ÿ IOï¼Œè¨­å®š flush&#x3D;time çš„æ™‚é–“å®šæœŸè™•ç†</li></ol><h2 id="Nginx-config-åŸºç¤è¨­å®š"><a href="#Nginx-config-åŸºç¤è¨­å®š" class="headerlink" title="Nginx config åŸºç¤è¨­å®š"></a>Nginx config åŸºç¤è¨­å®š</h2><p>ç¶²ç«™æ¶è¨­é¦–å…ˆæœƒéœ€è¦æ”¾ç½®æª”æ¡ˆåˆ° Nginx ä¼ºæœå™¨</p><ol><li>FTPï¼Œæ¶è¨­çš„æ–¹å¼å¾ˆå¤šéƒ¨è½å®¢éƒ½æœ‰æ•™å­¸</li><li>jenkinsï¼Œå¾ç‰ˆæ§æŠ“ master branch ä¸‹ä¾†è‡ªå‹• build åŠåŸ·è¡Œ shell è¨˜å¾— <code>BUILD_ID=DONTKILLME</code></li></ol><p>è¨­å®šæ¥å—è«‹æ±‚çš„ç¨‹å¼ (å¾Œç«¯ API æˆ–ç›¸é—œè³‡æº)</p><ol><li>éœæ…‹çš„æª”æ¡ˆï¼Œå‰ç«¯å¸¸è¦‹ SPA (single-page application) å°ˆæ¡ˆï¼Œéœ€ä¸Šå‚³éœæ…‹ç¶²é åˆ° Serverï¼Œä¸¦è¨­å®šæ­£ç¢ºçš„è·¯ç”±æ‰èƒ½å¤ å›æ‡‰çµ¦ä½¿ç”¨è€…</li><li>å¦‚æœæ˜¯ node.js çš„å¾Œç«¯ï¼Œéœ€è¦ä½¿ç”¨ PM2 é€™é¡çš„å·¥å…·é€²è¡Œç®¡ç†ï¼Œä¹Ÿæ¨è–¦ä½¿ç”¨ cluster mode ç„¡ç—›å‡ç´šæ•ˆèƒ½</li></ol><p>è¨­å®šç¶²ç«™ä¸»è¦è¨­å®š server_name æŒ‡å®šç¶²åŸŸï¼Œæ¥è‘—åœ¨ DNS æŒ‡å‘ä¸»æ©Ÿå°±å¤§åŠŸå‘Šæˆã€‚</p><ul><li>éœæ…‹ç¶²ç«™: æŒ‡å‘æ­£ç¢ºå°±å¯ä»¥äº†</li><li>å‹•æ…‹ç¶²é : å¦‚ php éœ€è¦æ­é… fastcgi åšç›¸é—œåå‘ä»£ç†çš„è¨­å®š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen         80 default_server;</span><br><span class="line">    server_name    example.com www.example.com;</span><br><span class="line">    root           /var/www/example.com;</span><br><span class="line">    index          index.html;</span><br><span class="line">    try_files <span class="variable">$uri</span> /index.html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen         80 default_server;</span><br><span class="line">    server_name    example2.com www.example2.com;</span><br><span class="line">    root           /var/www/example2.com;</span><br><span class="line">    index          index.html;</span><br><span class="line">    try_files <span class="variable">$uri</span> /index.html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¸¸è¦‹çš„-Nginx-Config"><a href="#å¸¸è¦‹çš„-Nginx-Config" class="headerlink" title="å¸¸è¦‹çš„ Nginx Config"></a>å¸¸è¦‹çš„ Nginx Config</h2><p>ä¸»è¦ä»‹ç´¹ä¸‹é¢å¹¾é …</p><ul><li>Nginx proxy_pass</li><li>Nginx Reverse Proxy</li><li>Nginx https</li></ul><h3 id="Nginx-proxy-pass-è¨­å®š"><a href="#Nginx-proxy-pass-è¨­å®š" class="headerlink" title="Nginx proxy_pass è¨­å®š"></a>Nginx proxy_pass è¨­å®š</h3><p>Nginx proxy_pass çš„ç›®çš„å°±æ˜¯å°æµï¼Œé€éä¸åŒçš„è¨­å®šæ–¹å¼å°æµåˆ°ä¸åŒçš„ç¶²ç«™ç›®éŒ„ï¼Œé€™å°±æ˜¯åå‘ä»£ç†çš„ä¸€å€‹æ¦‚å¿µã€‚</p><ul><li>å°æµåˆ°æ ¹ç›®éŒ„: <code>test.com/app/xxxxx =&gt; http://192.168.1.100/xxxxx</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /app/ &#123;</span><br><span class="line">    proxy_pass      http://192.168.1.100/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å°æµåˆ°ç‰¹å®šç›®éŒ„: <code>test.com/app/xxxxx =&gt; http://192.168.1.100/maped_dir/xxxxx</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /app/ &#123;</span><br><span class="line">    proxy_pass       http://192.168.1.100/maped_dir/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åå‘ä»£ç†-Nginx-Reverse-Proxy"><a href="#åå‘ä»£ç†-Nginx-Reverse-Proxy" class="headerlink" title="åå‘ä»£ç† (Nginx Reverse Proxy)"></a>åå‘ä»£ç† (Nginx Reverse Proxy)</h3><p>ç¶²åŸŸå¾€å¾€åªèƒ½é€£åˆ°ä¸€å°å…¥å£ä¸»æ©Ÿï¼Œä½†ç•¶æˆ‘å€‘å¾Œç«¯æœ‰å¾ˆå¤šç¶²ç«™åŠæœå‹™åˆ†é…åˆ°å¤šå°ä¸»æ©Ÿæ™‚ï¼Œé€™æ™‚å€™å°±éœ€è¦é€éè·¯å¾‘ä¸Šçš„ä»£ç†ä¾†è½‰ç™¼é‚„æœ‰é…ç½®é™„è¼‰å¹³è¡¡ï¼ŒNginx å°±æä¾›äº†é€™æ¨£çš„åŠŸèƒ½ï¼Œç•¶ç„¶ AWS ä¸Šä¹Ÿæœ‰æä¾›ç›¸é—œæœå‹™ã€‚</p><p>é™¤æ­¤ä¹‹å¤–é‚„å¯ä»¥åšè² è¼‰å¹³è¡¡ï¼Œåå‘ä»£ç†è©²è¨­çš„åƒæ•¸è¦è¨­å°ï¼Œ<a target="_blank" rel="noopener" href="https://www.facebook.com/pcman.im/posts/1835852189787783">proxy_http_version 1.1 è«‹æ³¨æ„</a>ï¼Œæœ‰äººæœ‰è¸©éé›·äº†ï¼Œå¦å¤–é™„è¼‰å¹³è¡¡ä¹Ÿå¾ˆç°¡å–®ï¼Œå…¶ä¸­æœ‰å¹¾ç¨®æ¨¡å¼å¯ä»¥æä¾›é¸æ“‡ï¼Œä¹Ÿå¯ä»¥é€²ä¸€æ­¥è¨­å®š health_checkï¼Œè®“ Nginx å»å®šæ™‚ç¢ºèªå¾Œç«¯ä¼ºæœå™¨æ˜¯å¦å®‰å¥½ã€‚</p><ul><li>least_conn é¸æ“‡æœ€å°‘é€£ç·šæ•¸</li><li>least_time å›æ‡‰æ™‚é–“</li><li>weight å€æ•¸</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">upstream myapp1 &#123;</span><br><span class="line">    server srv1.example.com weight=3;</span><br><span class="line">    server srv2.example.com;</span><br><span class="line">    server srv3.example.com;</span><br><span class="line">    least_conn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">      location / &#123;</span><br><span class="line">            proxy_pass http://myapp1;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Nginx-https-è¨­å®š"><a href="#Nginx-https-è¨­å®š" class="headerlink" title="Nginx https è¨­å®š"></a>Nginx https è¨­å®š</h3><p>https å¯ä»¥ä½¿ç”¨å…è²»çš„ Letâ€™s Encryptï¼Œåœ¨ https å®‰è£ä¸Šæ¨è–¦ä½¿ç”¨<a target="_blank" rel="noopener" href="https://certbot.eff.org/">æ†‘è­‰æ©Ÿå™¨äºº</a> è‡ªå‹•æ›´æ–° Letâ€™s Encrypt æ†‘è­‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> certbot --nginx -d test.domain.com</span><br><span class="line"><span class="built_in">sudo</span> certbot delete --cert-name test.domain.com</span><br><span class="line"><span class="built_in">sudo</span> certbot renew --dry-run</span><br></pre></td></tr></table></figure><p>åŸ·è¡ŒæŒ‡ä»¤å¾Œåœ¨æª”æ¡ˆæœƒçœ‹åˆ° <code># managed by Certbot</code> è¨»è§£ï¼Œä»£è¡¨é€™éƒ¨åˆ†è¨­ç½®å°±ä¸éœ€è¦æˆ‘å€‘ç¶­è­·ï¼Œ<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-16-04">Digital Ocean æä¾›äº†å¾ˆè©³ç›¡çš„æ•™å­¸</a>ï¼Œéå¸¸æ¨è–¦ã€‚</p><p>æ¥è‘—å¯«å¥½æƒ³è¦åŸ·è¡Œçš„ <code>test.sh</code> æª”ä¸¦è¨­å®š Linux æ’ç¨‹å®šæ™‚æ›´æ–° SSL æ†‘è­‰ï¼Œè¨˜å¾—å°‡æª”æ¡ˆæ”¹å¥½æ¬Šé™ <code>chmod +x test.sh</code>ï¼Œä¸‹é¢ç¤ºç¯„æœƒç”¢ç”Ÿè³‡æ–™å¤¾:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">DIR=`<span class="built_in">date</span> +%D`</span><br><span class="line">DEST=~/test/<span class="variable">$DIR</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$DEST</span></span><br></pre></td></tr></table></figure><p>è‡ªè¨‚çš„æ’ç¨‹æ™‚é–“å‰‡å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-cron-to-automate-tasks-on-a-vps">crontab</a>ï¼Œä½¿ç”¨ <code>crontab -e</code>é€²è¡Œç·¨è¼¯ï¼Œé€éåˆ†é˜ã€å°æ™‚ã€æ—¥ã€æœˆã€æ˜ŸæœŸå¹¾ä¾†é€²è¡Œé€±æœŸè¨­å®šã€‚</p><ul><li>è­¬å¦‚æ¯å€‹æ˜ŸæœŸäºŒçš„ 4:00am å°±å¯ä»¥å¯«æˆ <code>0 4 * * 2 ~/test.sh</code></li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨ç¸®å¯« <code>@daily ~/test.sh</code></li></ul><p>ç›¸é—œç¸®å¯«å¦‚ä¸‹ï¼š</p><ul><li>@hourly <code>0 * * * *</code></li><li>@daily <code>0 0 * * *</code></li><li>@weekly <code>0 0 * * 0</code></li><li>@monthly <code>0 0 1 * *</code></li><li>@yearly <code>0 0 1 1 *</code></li></ul><p>é˜²å‘†å¯ä»¥å…ˆç”¨ä¸‹é¢é€™å€‹ç¶²ç«™è©¦å¯«:<br><a target="_blank" rel="noopener" href="https://crontab.guru/">https://crontab.guru/</a></p><h2 id="Nginx-æ•ˆèƒ½å„ªåŒ–è¨­å®š"><a href="#Nginx-æ•ˆèƒ½å„ªåŒ–è¨­å®š" class="headerlink" title="Nginx æ•ˆèƒ½å„ªåŒ–è¨­å®š"></a>Nginx æ•ˆèƒ½å„ªåŒ–è¨­å®š</h2><p>Linux è¨­å®šæª”åœ¨ <code>/etc/nginx</code>ï¼Œé™¤äº† epoll å¯ä»¥å¾æ©Ÿåˆ¶ä¸Šå½±éŸ¿æ•ˆèƒ½å¤–ï¼Œä¹Ÿèƒ½å¾ç³»çµ±<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/ngx_core_module.html">æ ¸å¿ƒçš„è¨­å®š</a>å„ªåŒ–æ•ˆèƒ½ã€‚</p><ul><li>worker_processes å°±æ˜¯é…åˆä¸»æ©Ÿæ ¸å¿ƒæ•¸ï¼Œè‹¥æ˜¯ 4 æ ¸å¿ƒå°±å¯ä»¥è¨­ç½® <code>worker_processes 4</code></li><li>worker_rlimit_nofile æ˜¯å¯ä»¥é–‹å•Ÿçš„æª”æ¡ˆæ•¸é‡ï¼Œåƒæˆ‘ä»¥å‰å…¬å¸ä¼ºæœå™¨å°±æœ‰éœ€è¦æä¾›åœ–ç£šçš„å¿«å–ï¼Œè¨­å®šå¤§é‡çš„é–‹å•Ÿæª”æ¡ˆæ•¸é‡å¯ä»¥èªªæ˜¯å¿…é ˆ</li><li>å¿«å–ï¼Œåœ¨ Nginx ä¹Ÿæœ‰æä¾› proxy_cache_path çš„å¿«å–è¨­å®š</li><li>Gzip å£“ç¸®ï¼Œé€™å€‹åœ¨å¾ˆå¤šåœ°æ–¹éƒ½å¯ä»¥å•Ÿç”¨ï¼Œä¸ä¸€å®šéœ€è¦åœ¨ Nginx é–‹å•Ÿ</li><li>client_max_body_size é™åˆ¶æª”æ¡ˆä¸Šå‚³å¤§å°</li></ul><p>Connections ç›¸é—œ</p><ul><li>keepalive_requests: é è¨­å€¼ 100 å¯ä»¥é‚Šå£“æ¸¬é‚Šèª¿æ•´</li><li>keepalive_timeout: å¤šä¹…è¦åˆ‡æ‰</li><li>åå‘ä»£ç†çš„ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html?&_ga=2.54364971.2046281064.1594341677-1932426211.1594341677#keepalive">keepalive</a>ï¼Œè¨˜å¾—è¨­å®š proxy_http_version 1.1; proxy_set_header Connection â€œâ€;</li></ul><p>åŠ ä¸Šç›¸é—œé™åˆ¶</p><ul><li><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_limit_conn_module.html?&_ga=2.92243737.2046281064.1594341677-1932426211.1594341677#limit_conn">limit_conn</a> è­¬å¦‚æŸäº›è·¯ç”±å¾ˆä½”é »å¯¬å°±å¯ä»¥ç›´æ¥é™åˆ¶ï¼Œä¸è¦å½±éŸ¿å…¶ä»–å¿«é€Ÿçš„æœå‹™</li><li>limit_rate é™é€Ÿ</li><li>max_conns å¦‚æœ upstream æ˜¯æ¯”è¼ƒå¼±çš„æ©Ÿå°å°±å»ºè­°è¨­å®šä¸€ä¸‹</li></ul><p>å¦‚æœæœ‰éœ€è¦ç”¨åˆ° websocketï¼Œè¨­å®šæœƒä¸å¤ªä¸€æ¨£ï¼Œåƒè€ƒ<a target="_blank" rel="noopener" href="https://www.nginx.com/blog/websocket-nginx">å®˜ç¶²æ–‡ä»¶</a>éœ€è¦é…ç½®å¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">proxy_set_header Connection <span class="string">&quot;Upgrade&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="Nginx-Epoll"><a href="#Nginx-Epoll" class="headerlink" title="Nginx Epoll"></a>Nginx Epoll</h3><p>Nginx åœ¨ Linux çš„ IO æ©Ÿåˆ¶ä¸Šæœ‰æ”¯æ´ epollï¼Œæ‰€ä»¥åœ¨éœæ…‹ç¶²é çš„æ•ˆèƒ½ä¸Šé è¶…éä½¿ç”¨ select æ©Ÿåˆ¶çš„ apacheï¼Œé‚„æœ‰å…¶ä»–æ”¯æ´çš„æ©Ÿåˆ¶å¯ä»¥åƒè€ƒ<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/events.html">å®˜æ–¹æ–‡ä»¶</a>ã€‚</p><ul><li>Apache Select (blocking)ï¼šç›£è€ƒè€å¸«å•å­¸ç”Ÿï¼Œéš¨å ‚è€ƒè©¦å¯«å®Œæ²’ï¼Œæ”¶é›†è¶³å¤ å¾Œé€æ‰¹æ”¹ã€‚åŒæ™‚å¤ªå¤šå­¸ç”Ÿæ™‚ï¼Œæœƒéœ€è¦ç­‰å­¸ç”Ÿå›è¦†ï¼Œä¸Šé™é è¨­ 1024ã€‚</li><li>Nginx Epoll (non-blocking)ï¼šè€å¸«ä¸å†å•å­¸ç”Ÿï¼Œå­¸ç”Ÿå®Œæˆå¾Œæ”¾è¬›æ¡Œï¼Œæ”¶é›†è¶³å¤ å¾Œé€æ‰¹æ”¹ã€‚æ‰€ä»¥ä¼ºæœå™¨ç«¯ä¸€å®šæœƒæœ‰å›è¦†ï¼Œä½†ä¸ä¸€å®šæœƒæœ‰è³‡æ–™ (å¾…æ‰¹æ”¹æ¸…å–®)ï¼Œå¯èƒ½å› ç‚º timeout å›è¦†å·²éè™Ÿè«‹é‡æ–°é ˜å–è™Ÿç¢¼ç‰Œï¼Œç®—æ˜¯è§£æ±º C10K çš„ä¸€ç¨®æ–¹å¼ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">	use epoll;</span><br><span class="line">	worker_connections 1024;</span><br><span class="line">	multi_accept on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Linux-ç³»çµ±æ ¸å¿ƒè¨­å®š"><a href="#Linux-ç³»çµ±æ ¸å¿ƒè¨­å®š" class="headerlink" title="Linux ç³»çµ±æ ¸å¿ƒè¨­å®š"></a>Linux ç³»çµ±æ ¸å¿ƒè¨­å®š</h3><p>ä¸»è¦æ˜¯ç·¨è¼¯é€™å€‹æª”æ¡ˆ &#x2F;etc&#x2F;sysctl.conf</p><ul><li>sys.fs.file-max æœ€å¤§é–‹æª”ä¸Šé™ <code>sysctl -w fs.file-max=50000</code> (å¯ä»¥æš«æ™‚æ¸¬è©¦é‡é–‹æ©Ÿå¾Œæœƒæ¶ˆå¤±)</li><li>net.core.somaxconn: èƒ½è¢« nginx queue æ¥å—çš„æœ€å¤§é€£ç·šæ•¸ï¼Œå¯ä»¥è¨­å®šæˆ 512ï¼Œè¶…éé‚„éœ€è¦è¨­å®š listen çš„ backlog åƒæ•¸ï¼Œå› ç‚ºé™¤äº† FreeBSD, DragonFly BSD, macOS å…¶ä»–é è¨­å€¼æ˜¯ 511</li><li>net.core.netdev_max_backlog: ç¶²è·¯å¡çš„ backlogï¼ŒåŠ å¤§æœƒå¢åŠ æ•ˆèƒ½ï¼Œä½†ä¸äº†è§£ç¶²è·¯å¡çš„æ¥µé™å°±å®¹æ˜“å‡ºç¾éŒ¯èª¤ Orz</li><li>nofile ä¹Ÿè·Ÿé–‹æª”æ•¸æœ‰é—œæœƒåœ¨ &#x2F;etc&#x2F;security&#x2F;limits.conf</li></ul><p>Linux åº•ä¸‹çš„ç·¨è¼¯å™¨å»ºè­°ä½¿ç”¨ nanoï¼Œç›¸å°ç°¡å–®ï¼Œä½¿ç”¨æ™‚å°±æ˜¯ä½¿ç”¨æŒ‡ä»¤åŠ æª”å <code>nano test.conf</code>ï¼Œè‹¥æ˜¯è¦ä¿®æ”¹æ¬Šé™å¤–çš„æª”æ¡ˆå‰‡è¦ <code>sudo nano test.conf</code> ï¼Œå¸¸è¦‹çš„å¦‚ä¸‹ï¼Œvi å’Œ vim æœ‰å€åˆ†æŒ‡ä»¤æ¨¡å¼è·Ÿè¼¸å…¥æ¨¡å¼ï¼Œæ“ä½œæ¦‚å¿µè¼ƒç‚ºè¤‡é›œ:</p><ul><li>vi</li><li>vim</li><li>nano</li></ul><div class="google-ad"><ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-h4+1+1q-1t-2x" data-ad-client="ca-pub-1297466993744883" data-ad-slot="9012117796"></ins></div><hr><div class="more-article hidden-md hidden-lg"><span class="h4">æ›´å¤šç›¸é—œæ–‡ç« </span><hr class="hidden-sm hidden-xs"><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/2017/01/07/thinking-hello-2017/me.jpg"></div><div class="popular-posts-title"><h3><a href="/2017/01/07/thinking-hello-2017/" title="ä½¿ç”¨ Hexo æ¶è¨­éƒ¨è½æ ¼" rel="bookmark">ä½¿ç”¨ Hexo æ¶è¨­éƒ¨è½æ ¼</a></h3><span>2017-01-07<span></span></span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/img/icon_48.png"></div><div class="popular-posts-title"><h3><a href="/2021/07/07/tool-linux-server-faq/" title="æ¶è¨­ä½ çš„ç¶²ç«™ä¼ºæœå™¨" rel="bookmark">æ¶è¨­ä½ çš„ç¶²ç«™ä¼ºæœå™¨</a></h3><span>2021-07-07<span></span></span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/2022/12/25/tool-nginx-management/NginxProxyManager.png"></div><div class="popular-posts-title"><h3><a href="/2022/12/25/tool-nginx-management/" title="Nginx ç®¡ç†èˆ‡ç›£æ§å·¥å…·æ¨è–¦" rel="bookmark">Nginx ç®¡ç†èˆ‡ç›£æ§å·¥å…·æ¨è–¦</a></h3><span>2022-12-25<span></span></span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/img/icon_48.png"></div><div class="popular-posts-title"><h3><a href="/2025/06/22/cloud-platform/2025-aws-taiwan-summit/" title="2025 AWS é›²ç«¯é«˜å³°æœƒç™»å°" rel="bookmark">2025 AWS é›²ç«¯é«˜å³°æœƒç™»å°</a></h3><span>2025-06-22<span></span></span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/img/icon_48.png"></div><div class="popular-posts-title"><h3><a href="/2017/06/22/cloud-platform/cloud-web-service/" title="AWS Lambda vs EC2 vs Azure Web App vs Vercel" rel="bookmark">AWS Lambda vs EC2 vs Azure Web App vs Vercel</a></h3><span>2017-06-22<span></span></span></div></li></ul></div><hr class="hidden-md hidden-lg"><span id="likeCo" class="pl-4 ml-4" style="color:#9b9b9b">å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œè«‹å¹«å¿™æ‹æ‹æ‰‹å–” ğŸ¤£</span><hr><div class="likecoin-embed likecoin-button" style="margin:0;max-height:185px;min-height:185px" data-liker-id="linyencheng-tw" data-href="https://linyencheng.github.io/2019/07/13/tool-nginx"></div><hr><ul class="pager"><li class="previous"><a href="/2019/08/01/python-hypothesis-testing/" data-toggle="tooltip" data-placement="top" title="Python Hypothesis Testing (å‡è¨­æª¢å®š)">&larr; ä¸Šä¸€ç¯‡</a></li><li class="next"><a href="/2019/03/28/js-google-sheet-db/" data-toggle="tooltip" data-placement="top" title="Google è©¦ç®—è¡¨å¯¦ä½œç°¡æ˜“è³‡æ–™åº«">ä¸‹ä¸€ç¯‡ &rarr;</a></li></ul><br><div class="p-2 google-ad"><ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-1297466993744883" data-ad-slot="1800981579"></ins></div><div class="comment"><div id="disqus_thread" class="disqus-thread"></div></div></div><div class="col-lg-3 col-lg-offset-0 visible-lg-block sidebar-container catalog-container sticky__sidebar"><h5 id="-1" class="p-0"><a class="catalog-toggle" href="#">ç«™å…§æœå°‹</a></h5><div id="site_search"><div class="form-group mt-3"><input type="text" id="local-search-input" inputmode="search" name="q" results="0" autocomplete="off" placeholder="è«‹è¼¸å…¥é—œéµå­—" class="st-search-input st-default-search-input form-control"></div><div id="local-search-result"></div></div><div class="side-catalog"><h5 id="-1"><a class="catalog-toggle" href="#">å…¶ä»–ç›¸é—œæ–‡ç« </a></h5><hr class="hidden-sm hidden-xs"><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/2017/01/07/thinking-hello-2017/me.jpg"></div><div class="popular-posts-title"><h3><a href="/2017/01/07/thinking-hello-2017/" title="ä½¿ç”¨ Hexo æ¶è¨­éƒ¨è½æ ¼" rel="bookmark">ä½¿ç”¨ Hexo æ¶è¨­éƒ¨è½æ ¼</a></h3><span>2017-01-07<span></span></span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/img/icon_48.png"></div><div class="popular-posts-title"><h3><a href="/2021/07/07/tool-linux-server-faq/" title="æ¶è¨­ä½ çš„ç¶²ç«™ä¼ºæœå™¨" rel="bookmark">æ¶è¨­ä½ çš„ç¶²ç«™ä¼ºæœå™¨</a></h3><span>2021-07-07<span></span></span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img alt="yencheng" loading="lazy" src="https://linyencheng.github.io/2022/12/25/tool-nginx-management/NginxProxyManager.png"></div><div class="popular-posts-title"><h3><a href="/2022/12/25/tool-nginx-management/" title="Nginx ç®¡ç†èˆ‡ç›£æ§å·¥å…·æ¨è–¦" rel="bookmark">Nginx ç®¡ç†èˆ‡ç›£æ§å·¥å…·æ¨è–¦</a></h3><span>2022-12-25<span></span></span></div></li></ul></div><div class="side-catalog mt-3"><h5 class="widget-title">æœ€æ–°çš„æ–‡ç« </h5><hr class="hidden-sm hidden-xs"><div class="widget"><ul class="p-0 popular-posts"><li class="popular-posts-item"><div class="popular-posts-img"><img loading="lazy" src="https://linyencheng.github.io/img/icon_48.png"></div><div class="popular-posts-title"><h3 id="progressive-web-app-1"><a href="/2025/08/19/kimetsu-no-yaiba/ubuyashiki-kagaya-lead-org/" title="å®ˆè­·å¤§å®¶çš„æœ€å¼·ç¤¾é•·ç”¢å±‹æ•·è€€å“‰" rel="bookmark">å®ˆè­·å¤§å®¶çš„æœ€å¼·ç¤¾é•·ç”¢å±‹æ•·è€€å“‰</a></h3><span>2025-11-28</span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img loading="lazy" src="https://linyencheng.github.io/img/icon_48.png"></div><div class="popular-posts-title"><h3 id="progressive-web-app-1"><a href="/2025/08/10/kimetsu-no-yaiba/agatsuma-zenitsu-learn-one-thing/" title="æˆ‘å¦»å–„é€¸æ•™æœƒæˆ‘çš„äº‹æƒ…" rel="bookmark">æˆ‘å¦»å–„é€¸æ•™æœƒæˆ‘çš„äº‹æƒ…</a></h3><span>2025-11-28</span></div></li><li class="popular-posts-item"><div class="popular-posts-img"><img loading="lazy" src="https://linyencheng.github.io/img/icon_48.png"></div><div class="popular-posts-title"><h3 id="progressive-web-app-1"><a href="/2025/08/10/kimetsu-no-yaiba/kibutsuji-muzan-boss/" title="é¬¼æ»…ä¹‹åˆƒç„¡é™åŸä¸Šæ˜ ï¼å¾é¬¼èˆè¾»ç„¡æ…˜å­¸è·å ´ç®¡ç†" rel="bookmark">é¬¼æ»…ä¹‹åˆƒç„¡é™åŸä¸Šæ˜ ï¼å¾é¬¼èˆè¾»ç„¡æ…˜å­¸è·å ´ç®¡ç†</a></h3><span>2025-11-28</span></div></li></ul></div></div><div class="side-catalog mt-3 google-ad"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1297466993744883" data-ad-slot="9240487898" data-ad-format="auto" data-full-width-responsive="true"></ins></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"></div></div></div></article><script>var disqus_shortname="linyencheng",disqus_identifier="https://linyencheng.github.io/2019/07/13/tool-nginx/",disqus_url="https://linyencheng.github.io/2019/07/13/tool-nginx/";function loadLikeCo(){var e;(e=document.createElement("script")).type="text/javascript",e.defer=!0,e.src="//static.like.co/sdk/v1/button.js",(document.head||document.body).appendChild(e)}function loadDisqus(){var e;(e=document.createElement("script")).type="text/javascript",e.defer=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}var runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout(function(){var n;!isBot&&supportsIntersectionObserver?(n=new IntersectionObserver(function(e){e[0].isIntersecting&&(loadLikeCo(),n.disconnect())},{threshold:[0]})).observe(document.getElementById("likeCo")):loadLikeCo()},1),setTimeout(function(){var n;!isBot&&supportsIntersectionObserver?(n=new IntersectionObserver(function(e){e[0].isIntersecting&&(loadDisqus(),n.disconnect())},{threshold:[0]})).observe(document.getElementById("disqus_thread")):loadDisqus()},1)</script><script>function getQueryString(n){return Object.keys(n).map(t=>t+"="+n[t]).join("&")}function updateDom(t){t.result.viewCountTotal&&768<window.innerWidth&&(localStorage.setItem("2019%2F07%2F13%2Ftool-nginx%2F",JSON.stringify(t)),document.getElementById("viewCountTotal").innerHTML='| ğŸ‘€ <span class="pl-1">'+t.result.viewCountTotal+"</span>")}function getViewCount(){var t=getQueryString({url:"2019%2F07%2F13%2Ftool-nginx%2F",title:"Nginx%20Config%20%E8%88%87%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E6%95%99%E5%AD%B8",action:"read_viewCount"});fetch("https://script.google.com/macros/s/AKfycbzaNdmEmtd1OTLicwwL628yQsVLKV3eSkxKqIsgUZ3zVQKn2nAnCnrOGgMgT-T8364N/exec?"+t).then(t=>t.json()).then(t=>updateDom(t)).catch(t=>console.error(t))}function initViewCount(){var t=localStorage.getItem("2019%2F07%2F13%2Ftool-nginx%2F");t&&updateDom(JSON.parse(t)),setTimeout(()=>{getViewCount()},800)}initViewCount()</script><style>@media all and (min-width:800px){.anchorjs-link{position:absolute;left:-.75em;font-size:1.1em;margin-top:-.1em}}@media all and (max-width:800px){.google-ad{max-height:140px}}</style><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target="_blank" rel="noopener" aria-label="YenCheng's Medium" href="https://linyencheng-tw.medium.com/"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-medium fa-stack-1x fa-inverse"></i></span></a></li><li><a title="Facebook" target="_blank" rel="noopener" aria-label="YenCheng's Facebook" href="https://www.facebook.com/linyencheng.3mins"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a title="Github" target="_blank" rel="noopener" aria-label="YenCheng's Github" href="https://github.com/LinYenCheng"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a title="Linkedin" target="_blank" rel="noopener" href="https://www.linkedin.com/in/LinYenCheng"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted"><a title="éš±ç§æ¬Šæ”¿ç­–" href="/pravicy">éš±ç§æ¬Šæ”¿ç­–</a> | Copyright &copy; å‰ç«¯ä¸‰åˆ†é˜ 2025<br>Theme by <a title="åŸä½œè€…" target="_blank" rel="noopener" href="http://huangxuan.me">Hux</a> <span style="display:inline-block;margin:0 5px">& </span>Ported by <a title="ç¬¬äºŒä½œè€…" target="_blank" rel="noopener" href="https://github.com/Kaijun/hexo-theme-huxblog">Kaijun</a></p></div></div></div></footer><script defer>function loadScript(e,t){let n=document.createElement("script");n.src=e,n.defer=!0,n.onload=()=>t(null),n.onerror=e=>t(e),setTimeout(()=>{document.head.appendChild(n)},800)}function loadCSS(e,t){var n=document.createElement("link");n.rel="preload",n.href=e,n.as="style",document.head.appendChild(n);let l=document.createElement("link");l.rel="stylesheet",l.href=e,l.onload=()=>t(null),l.onerror=e=>t(e),setTimeout(()=>{document.head.appendChild(l)},800)}loadCSS("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css",()=>{console.log("load font-awesome.min.css")}),loadScript("https://linyencheng.github.io/js/jquery.min.js",function(){var e=window,t=document,n="script",l="dataLayer";e[l]=e[l]||[],e[l].push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),e=t.getElementsByTagName(n)[0],(l=t.createElement(n)).defer=!0,l.src="https://www.googletagmanager.com/gtm.js?id=GTM-W5LMXCR",e.parentNode.insertBefore(l,e),window.initViewCountAll&&window.initViewCountAll(),window.initViewCount&&window.initViewCount();{document.querySelectorAll("#toc .toc-item:has(> .toc-child)").forEach(n=>{var e=n.querySelector(".toc-link");let t=document.createElement("i");t.classList.add("fa","fa-caret-down");var l=document.createElement("i");l.classList.add("fa","fa-caret-right"),n.prepend(t,l),l.classList.add("hide"),n.querySelectorAll("i").forEach(t=>{t.addEventListener("click",function(){var e=n.querySelector(".toc-child");e.style.display="none"===e.style.display?"block":"none",t.classList.toggle("hide"),t.nextElementSibling.classList.toggle("hide")})}),e.addEventListener("dblclick",function(){n.querySelector(".toc-child").style.display="none",t.classList.toggle("hide")}),e.addEventListener("click",function(){var e=n.querySelector(".toc-child");e.style.display="none"===e.style.display?"block":"none",t.classList.toggle("hide")})});let t=document.querySelector("#toc .toc-title");t&&(t.classList.add("clickable"),t.addEventListener("click",function(){var e=t.nextElementSibling;"none"===e.style.display?(e.style.display="block",caretDown.classList.remove("hide"),caretRight.classList.add("hide")):(e.style.display="none",caretDown.classList.add("hide"),caretRight.classList.remove("hide"))}))}loadScript("https://linyencheng.github.io/js/bootstrap.min.js",function(){loadScript("https://linyencheng.github.io/js/hux-blog.min.js",function(){setTimeout(()=>{searchFunc("/search.xml","local-search-input","local-search-result")},3e3),document.getElementById("tag_cloud")&&loadScript("https://linyencheng.github.io/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})})})})</script></body></html>